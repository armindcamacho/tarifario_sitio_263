<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Tarifario Sitio 263</title>
    <link rel="icon" type="image/png" href="logo.png">
    <link rel="apple-touch-icon" href="logo.png">
    <link rel="manifest" href="manifest.json">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">

    <style>
        body { font-family: sans-serif; margin: 0; background-color: #f4f4f4; display: flex; justify-content: center; }
        .container { background: white; width: 100vw; min-height: 100vh; padding: 20px; box-sizing: border-box; position: relative; }
        h2 { text-align: center; color: #2c3e50; }

        .tabs { display: flex; gap: 10px; margin-bottom: 15px; }
        .tab-btn { flex: 1; padding: 15px; border: none; border-radius: 8px; font-weight: bold; background: #ddd; cursor: pointer; }
        .tab-btn.active { background: #27ae60; color: white; }

        .buscador-wrapper { position: relative; width: 100%; }
        #destinoInput { width: 100%; padding: 15px; font-size: 16px; border: 2px solid #ccc; border-radius: 8px; box-sizing: border-box; }
        
        .lista-desplegable { 
            position: absolute; top: 100%; left: 0; right: 0; 
            background: white; border: 2px solid #27ae60; 
            max-height: 250px; overflow-y: auto; z-index: 9999; 
            display: none; box-shadow: 0 4px 10px rgba(0,0,0,0.2); 
        }
        .opcion-item { padding: 15px; border-bottom: 1px solid #eee; cursor: pointer; font-size: 16px; }

        .btn-limpiar { width: 100%; margin-top: 15px; padding: 15px; background: #34495e; color: white; border: none; border-radius: 8px; font-weight: bold; }
        #resultado { margin-top: 20px; text-align: center; padding: 15px; border-radius: 8px; background: #f9f9f9; min-height: 80px; }
        .precio-mxn { font-size: 32px; color: #27ae60; font-weight: bold; display: block; }
    </style>
</head>
<body>

<div class="container">
    <h2>Tarifas Sitio 263</h2>
    
    <div class="tabs">
        <button id="btnLocal" class="tab-btn active" onclick="cambiarModo('locales')">LOCAL (MXN)</button>
        <button id="btnForaneo" class="tab-btn" onclick="cambiarModo('foraneos')">FORÁNEO (USD)</button>
    </div>

    <div class="buscador-wrapper">
        <input type="text" id="destinoInput" placeholder="Escribe el destino..." autocomplete="off">
        <div id="listaOpciones" class="lista-desplegable"></div>
    </div>
    
    <button class="btn-limpiar" onclick="limpiar()">Nueva Consulta</button>
    <div id="resultado"></div>
</div>

<script src="lista_de_precios.js"></script>
<script>
    let modoActual = 'locales';
    const input = document.getElementById('destinoInput');
    const lista = document.getElementById('listaOpciones');
    const display = document.getElementById('resultado');

    function cambiarModo(nuevo) {
        modoActual = nuevo;
        document.getElementById('btnLocal').classList.toggle('active', modoActual === 'locales');
        document.getElementById('btnForaneo').classList.toggle('active', modoActual === 'foraneos');
        limpiar();
    }

    async function obtenerConversion(usd) {
        display.innerHTML = "Sincronizando...";
        const hoy = new Date().toLocaleDateString('es-MX');
        let valor = localStorage.getItem('tc_valor');
        let fecha = localStorage.getItem('tc_fecha');

        if (fecha !== hoy || !valor) {
            try {
                const res = await fetch('https://open.er-api.com/v6/latest/USD');
                const data = await res.json();
                valor = data.rates.MXN;
                localStorage.setItem('tc_valor', valor);
                localStorage.setItem('tc_fecha', hoy);
            } catch(e) { valor = valor || 17.50; }
        }
        
        const total = (usd * valor).toFixed(2);
        display.innerHTML = `<span class="precio-mxn">$${total} MXN</span>
                             <small>Dólar fijado hoy: ${parseFloat(valor).toFixed(2)}</small>`;
    }

    input.addEventListener('input', () => {
        const busqueda = input.value.toUpperCase();
        lista.innerHTML = '';
        if (!busqueda || typeof listaprecios === 'undefined') { lista.style.display = 'none'; return; }

        const datos = listaprecios[modoActual];
        const coinciden = Object.keys(datos).filter(d => d.includes(busqueda));

        if (coinciden.length > 0) {
            coinciden.forEach(d => {
                const item = document.createElement('div');
                item.className = 'opcion-item';
                item.textContent = d;
                item.onclick = () => {
                    input.value = d;
                    lista.style.display = 'none';
                    if (modoActual === 'foraneos') obtenerConversion(datos[d]);
                    else display.innerHTML = `<span class="precio-mxn">$${datos[d]} MXN</span>`;
                };
                lista.appendChild(item);
            });
            lista.style.display = 'block';
        } else { lista.style.display = 'none'; }
    });

    function limpiar() {
        input.value = '';
        display.innerHTML = '';
        lista.style.display = 'none';
        input.focus();
    }

    // Cerrar lista si tocas fuera
    document.addEventListener('click', (e) => {
        if (!input.contains(e.target)) lista.style.display = 'none';
    });
</script>
</body>
</html>














